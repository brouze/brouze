<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Brouze | Help</title>

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/help-page.css" rel="stylesheet">






    <script src="https://cdn.firebase.com/js/client/2.2.7/firebase.js"></script>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    
    
    <script language="JavaScript" type="text/javascript" src="cryptico-master/random.js"></script>
    <script language="JavaScript" type="text/javascript" src="cryptico-master/hash.js"></script>
    <script language="JavaScript" type="text/javascript" src="cryptico-master/rsa.js"></script>
    <script language="JavaScript" type="text/javascript" src="cryptico-master/aes.js"></script>
    <script language="JavaScript" type="text/javascript" src="cryptico-master/api.js"></script>
    <script language="JavaScript" type="text/javascript" src="cryptico-master/jsbn.js"></script>


    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body onload="parseQueryString()">
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <p class="navbar-brand">Brouze</p>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <form class="navbar-form" role="form">
                        <div class="input-group">
                            <div class="form-group">
                                <!--<input type="text" class="form-control" id="srch-term" placeholder="Search Brouze">-->
                                <select class="form-control" id="subject">
                                    <option>Search Brouze</option>
                                    <option>Search All Tutors</option>
                                    <option>English</option>
                                    <option>History</option>
                                    <option>AP Spanish</option>
                                    <option>French</option>
                                    <option>AP French</option>
                                    <option>AP Computer Science</option>
                                    <option>Computer Science</option>
                                    <option>Pre-Algebra</option>
                                    <option>Algebra</option>
                                    <option>Algebra 2</option>
                                    <option>Geometry</option>
                                    <option>Trigonometry</option>
                                    <option>Precalculus</option>
                                    <option>AP Calculus AB</option>
                                    <option>AP Calculus BC</option>
                                    <option>Statistics</option>
                                    <option>Rhetoric</option>
                                    <option>AP English Literature</option>
                                    <option>AP English Language</option>
                                    <option>AP European History</option>
                                    <option>AP United States History</option>
                                    <option>Biology</option>
                                    <option>AP Biology</option>
                                    <option>Chemistry</option>
                                    <option>Chemistry Honors</option>
                                    <option>AP Chemistry</option>
                                    <option>AP Environmental Science</option>
                                    <option>Physics</option>
                                    <option>AP Physics</option>
                                    <option>SAT</option>
                                    <option>ACT</option>
                                </select>

                            </div>
                            <div class="input-group-btn">
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li class="dropdown-submenu">
                                        <a tabindex="-1" href="#">Subject</a>
                                        <ul class="dropdown-menu">
                                            <li><a href="">Subject</a></li>
                                            <li><a href="">Subject</a></li>
                                            <li><a href="">Subject</a></li>
                                            <li><a href="">Subject</a></li>
                                            <li><a href="">Subject</a></li>
                                            <li><a href="">Subject</a></li>
                                        </ul>
                                    </li>
                                    <li><a href="">Tutor Name</a></li>
                                </ul>
                                <button class="btn btn-default" type="button" onclick="sendWord()"><i class="glyphicon glyphicon-search"></i></button>
                            </div>
                            <!-- /btn-group -->
                        </div>

                        <!-- /input-group -->
                        <!--<button class="btn btn-default" type="button" onclick="getWord()"><i class="glyphicon glyphicon-search"></i></button>-->
                    </form>

                </ul>
                <ul class="nav navbar-nav">
                    <li class="active"><a onclick="unsecret()">Help</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">

                    <li class="dropdown">
                        <a id="dropMenu" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menu  <span class="caret" aria-hidden="true"></span></a>
                        <ul class="dropdown-menu">
                            <li><a onclick="home()">Profile</a></li>
                            <li><a onclick="saveRedirect()">Saved Tutors</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a onclick="signOut()">Sign Out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>




    <!--Content-->
    <div id="main" class="container">
        <div class="row">
            <h1>Help</h1>
        </div>
        <div id="content" class="row">
            <div id="sidenav" class="col-lg-3">
                <h2>Guide</h2>
                <a href="#prof">Your Profile</a>
                <br>
                <a href="#nav">The Navigation Bar</a>
                <br>
                <a href="#searchInfo">Searching Tutors</a>
                <br>
                <a href="#save">Saving Tutors</a>
            </div>
            <div id="tips" class="col-lg-9">
                <h2 id="prof">Your Profile</h2>
                <p class="centered">When you sign in to Brouze, you are first taken to your profile page.</p>
                <img class="img-responsive help" src="img/help/profile.PNG">
                
                <p class="centered">If you would like to edit any of your basic information, click the “Edit Profile” button. Keep in mind that your username may not be changed.</p>
                <img class="img-responsive help" src="img/help/profile3.PNG">

                <p class="centered">To add classes that you would like to tutor in, or to add classes that you want help in, click the orange plus buttons.</p>
                <img class="img-responsive help" src="img/help/profile6.png">

                <p class="centered">To edit your profile picture, click on the picture and enter the url of the image you’d like to replace it with.</p>
                <img class="img-responsive help" src="img/help/profile7.PNG">

                <h2 id="nav">The Navigation Bar</h2>
                <p class="centered"><b>Search Bar:</b> to search Brouze’s catalogue of tutors, select a subject, and click on the “search” icon. You can search from anywhere within your account.</p>
                <img class="img-responsive help" src="img/help/profile8.PNG">
               
                
                <p class="centered"><b>Help:</b> this tab will bring you to the help page (where you are right now!).</p>
                <img class="img-responsive help" src="img/help/navbar1.png">
                <p class="centered"><b>Dropdown menu:</b> Use this menu to navigate back to your profile, see your saved tutors, and sign out from your Brouze account.</p>
                <img class="img-responsive help" src="img/help/navbar2.PNG">


                <h2 id="searchInfo">Searching Tutors</h2>

                <p class="centered">To start your search through Brouze’s catalogue of tutors, choose a subject you’d like to search for in the search bar at the top of the page. Once you have selected your subject, click on the “search” icon.</p>
                 <img class="img-responsive help" src="img/help/profile8.PNG">

                <p class="centered">Once you have clicked the search icon, you will be taken to the Results page. From there, you may click on users’ profiles.</p>
                 <img class="img-responsive help" src="img/help/searchtutors1.PNG">

                <p class="centered">On the results page, you may also filter the tutors by filling in the form on the left side.</p>
                 <img class="img-responsive help" src="img/help/searchtutors2.PNG">

                <h2 id="save">Saving Tutors</h2>

                <p class="centered">When viewing other profiles, you can save them as potential tutors. This is done by clicking the orange “Add to Favorites” button at the top right of their profile.</p>
                 <img class="img-responsive help" src="img/help/savetutors1.PNG">
                <p class="centered">If you change your mind, you may also remove a saved tutor by clicking on the “Remove from Favorites” button.</p>
                <img class="img-responsive help" src="img/help/savetutors2.PNG">
                <p class="centered">To view your saved tutors, locate the dropdown menu on the right side of the navigation bar. Clicking on the “Saved Tutors” option will bring you to a separate page.</p>
                <img class="img-responsive help" src="img/help/savetutors3.PNG">
            </div>

        </div>
    </div>



    <div class="foot">
        <h5>Copyright 2015 - YAAAS Labs</h5>
    </div>



    <script>
        var data;
        var profileOwner;
        var pageViewer;
        var match = true;
        var profileViewer;
        var favorite;
        /*function parseQueryString(){
            data = GetUrlValue("username_a");
            console.log(data);
            profileOwner = GetUrlValue("username_b");
            console.log(profileOwner);
            accessInfo(data);
                               
        }*/
        var parseQueryString = function() {
            var queryString = window.location.search;
            queryString = queryString.substring(1);
            queryString = atob(queryString);
            var params = {},
                queries, temp, i, l;
            // Split into key/value pairs
            queries = queryString.split("&");
            // Convert the array of strings into an object
            for (i = 0, l = queries.length; i < l; i++) {
                temp = queries[i].split('=');
                params[temp[0]] = temp[1];
            }
            console.log("dude 15");
            data = params["username"];
            profileOwner = params["username"];
            console.log(params["username"]);
            pageViewer = params["pageOwner"];
            if (pageViewer != data) {
                console.log("the user is not the viewer");
                //$(".canTutorButton").hide();
                match = false;
                $(".canTutorButton").hide();
            }
            accessInfo(params["username"]);
            console.log("page Owner " + params["pageOwner"]);
        };

        function GetUrlValue(VarSearch) {
            var SearchString = window.location.search.substring(1);
            var VariableArray = SearchString.split('&');
            for (var i = 0; i < VariableArray.length; i++) {
                var KeyValuePair = VariableArray[i].split('=');
                if (KeyValuePair[0] == VarSearch) {
                    return KeyValuePair[1];
                }
            }
        }

        function accessInfo(info) {
            console.log("what is the info");
            console.log(info);
            // Get a reference to our users
            var ref = new Firebase("https://brouze.firebaseio.com/users/" + info + "/basicInfo");
            ref.on("value", function(snapshot) {
                var currentUser = snapshot.val();
                console.log(currentUser);
                console.log(currentUser.username);
                console.log(currentUser.name);
                //createDiv(currentUser.name);
                //createImg(currentUser.profilepic);
                //createDiv(currentUser.name);
                //document.write("hello " + currentUser.username);'
                //createH1(currentUser.name);
                // name school zip age grade
                //time to decorate!
                $("#profileImage").attr('src', currentUser.profilepic);
                $("#name").text(currentUser.name);
                $("#school").text(currentUser.school);
                $("#zip").text("Zipcode: " + currentUser.zipcode);
                $("#age").text("Age: " + currentUser.age);
                $("#grade").text("Grade: " + currentUser.grade);
                $("#dropMenu").text("Hello " + currentUser.username + "   ");
                $("#dropMenu").append('<span class="caret" aria-hidden="true"></span>');
                $("#desc").text(currentUser.blurb);
                if (currentUser.email !== undefined) {
                    $("#email").text("email: " + currentUser.email);
                }
                if (currentUser.phone !== undefined) {
                    $("#phone").text("phone number: " + currentUser.phone);
                }
                //need to fix/update
                $("prefLoc").text("Tutoring location(s): " + currentUser.loc1 + currentUser.loc2 + currentUser.loc3 + currentUser.loc4);
                addRow();
                addRowTwo();
                $("body").fadeIn(10);
            }, function(errorObject) {
                console.log("The read failed: " + errorObject.code);
            });
            if (!match) {
                searchFave();
            }
        }

        function createDiv(divText) {
            //$('#title').append('<p> hello ' + divText + '<p>');
            $("#name").text(divText);
        }

        function createImg(url) {
            var img = $('<img id="dynamic">'); //Equivalent: $(document.createElement('img'))
            //img.attr('src', url);
            //img.attr('shape',"circle");
            img.appendTo('body');
            $('body').append('<h1> hello ' + divText + '<p>');
        }

        function redirect() {
            console.log("xox redirect");
            window.location.href="form-two.html?username=" + data;
        }

        function redirectTwo() {
            console.log("xox redirect");
            window.location.href="form-three.html?username=" + data;
        }

        function redirectThree() {
            console.log("xox redirect");
            window.location.href="editbasicinfo.html?username=" + data;
        }

        function addRow() {
            var i;
            console.log("Attempting to append");
            //$('#canTutorTable tr:last').after('<tr><td>hello</td><td>world</td></tr>');
            var skillsRef = new Firebase("https://brouze.firebaseio.com/users/" + data + "/skills"); //we are looking at the skills of the specific user
            skillsRef.once("value", function(snapshot) {
                // The callback function will get once for each class
                snapshot.forEach(function(childSnapshot) {
                    // key will be the name of the class they are taking 
                    var key = childSnapshot.key();
                    // childData will be the actual contents of the child
                    var childData = childSnapshot.val();
                    //var category= childData.category;
                    var price = childData.pay;
                    var teacher = childData.teacher;
                    var yearTaken = childData.year;
                    var comments = childData.comment;
                    var grade = childData.grade;
                    var AP = childData.AP;
                    $('#canTutorTable tr:last').after('<tr><td>' + key + '</td><td>' + teacher + '</td><td>' + yearTaken + '</td><td>' + grade + '</td><td>' + AP + '</td><td>$' + price + '</td><td>' + comments + '</td><td></tr>');
                    if (match) {
                        $('#canTutorTable td:last').after('<td><a onclick="deleteStrength(this)"id="' + key + '"><span class="glyphicon glyphicon-trash deleteButton" aria-hidden="true"></span></a></td>');
                    }
                    /*$("#"+key).click(function(){
                        console.log("key what's up ");
                           // window.document.location = $(this).data("href");
                    });*/
                    /*$("#canTutorTable").on('click', '#'+key, function(){
                            var status = $(this).attr('id');
                            console.log(status);
                            //console.log(miniKey);
                            //console.log(miniKey.ID);
                             //window.location.replace("profile.html?" + "username=" + miniKey + "&pageOwner="+userData);
                    });*/
                });
            });
            if (match === false) {
                console.log("fight me son");
                $("#editProfile").hide();
            } else {
                $("#fave").hide();
                $("#unfave").hide();
            }
        }

        function addRowTwo() {
            console.log("Attempting to append");
            //$('#canTutorTable tr:last').after('<tr><td>hello</td><td>world</td></tr>');
            var weakRef = new Firebase("https://brouze.firebaseio.com/users/" + data + "/weaknesses"); //we are looking at the skills of the specific user
            weakRef.once("value", function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var key = childSnapshot.key();
                    var childData = childSnapshot.val();
                    var teacher = childData.teacher;
                    var comments = childData.comment;
                    var grade = childData.grade;
                    console.log(key);
                    console.log(teacher);
                    console.log(comments);
                    console.log(grade);
                    //console.log(key);
                    $('#cantTutorTable tr:last').after('<tr><td>' + key + '</td><td>' + teacher + '</td><td>' + grade + '</td><td>' + comments + '</td><td></tr>');
                    if (match) {
                        $('#cantTutorTable td:last').after('<td><a onclick="deleteWeakness(this)"id="' + key + '"><span class="glyphicon glyphicon-trash deleteButton" aria-hidden="true"></span></a></td>');

                    }
                });
            });
        }
        /*$('td a').on('click', function() {
            console.log("I got clicked");
        });*/


        function deleteWeakness(obj) {

            console.log(obj);
            var deleted = $(obj).attr('id');
            console.log(deleted);
            var tempRef = new Firebase("https://brouze.firebaseio.com/users/" + data + "/weaknesses/" + deleted);
            tempRef.remove();
            window.location.replace("profile.html?" + "username=" + pageViewer + "&pageOwner=" + pageViewer);
            // All data at the database location for user 'fred' has been deleted
            // (including any child data)
            // delete from weaknesses here


        }

        function deleteStrength(obj) {

            console.log(obj);
            var deleted = $(obj).attr('id');
            console.log(deleted);
            var tempRef = new Firebase("https://brouze.firebaseio.com/users/" + data + "/skills/" + deleted);
            tempRef.remove();
            window.location.replace("profile.html?" + "username=" + pageViewer + "&pageOwner=" + pageViewer);
            //delete from strengths here
        }

        function signOut() {
            var outRef = new Firebase("https://brouze.firebaseio.com");
            outRef.unauth();
            window.location.replace("index.html");
        }

        function sendWord() {
            var keyWord = $("#subject").val();
            var secret = "username=" + pageViewer + "&word=" + keyWord;
            secret = btoa(secret);
            window.location.href="search.html?" + secret;
        }

        function home() {
            var secret = "username=" + pageViewer + "&pageOwner=" + pageViewer;
            secret = btoa(secret);
            window.location.href="profile.html?" + secret;
        }

        function imageEdit() {
            if (match == true) {
                var person = prompt("Please enter a new image URL", "paste URL here");
                if (person != null) {
                    var basicRef = new Firebase("https://brouze.firebaseio.com/users/" + data + "/basicInfo");
                    basicRef.update({
                        "profilepic": person
                    });
                    home();
                }
            }
        }

        function pushFave() {
            var newRef = new Firebase("https://brouze.firebaseio.com/users/" + pageViewer);
            //var classRef = usernameRef.child("skills");
            newRef.child("faves").child(data).set({
                faveKey: data
            });
        }
        function unsecret(){
            var secretRef = new Firebase("https://brouze.firebaseio.com/users/keys/leaf");
            //var MattsRSAkey;
            //var CipherText;
            var message;
            secretRef.on("value", function(snapshot) {
                var PassPhrase = "The Moon is a Harsh Mistress."; 
            // The length of the RSA key, in bits.
                var Bits = 1024; 
                var MattsRSAkey = cryptico.generateRSAKey(PassPhrase, Bits);
                var currentUser = snapshot.val();
                var EncryptionResult = currentUser.message;
                //var MattsRSAkey = currentUser.private;
                console.log(EncryptionResult);
                console.log(MattsRSAkey);
               // var DecryptionResult = cryptico.decrypt(CipherText.cipher, MattsRSAkey);
                var DecryptionResult = cryptico.decrypt(EncryptionResult.cipher, MattsRSAkey);
                message = DecryptionResult.plaintext;
                console.log(message);
                //cryptico.decrypt(CipherText, MattsRSAkey);
            //console.log(DecryptionResult.plaintext);
                console.log(DecryptionResult.plaintext);
                
            }, function(errorObject) {
                console.log("The read failed: " + errorObject.code);
            });
            //return message;
            
        }
        function popFave() {
            var endRef = new Firebase("https://brouze.firebaseio.com/users/" + pageViewer + "/faves/" + data);
            endRef.remove();
        }

        function saveRedirect(){
            console.log(data)
            var secret = "username=" + data + "&pageOwner=" + data;
            secret = btoa(secret);
            window.location.href="savedtutors.html?" + secret;
        }

        function searchFave() {
            var ref = new Firebase("https://brouze.firebaseio.com/users/" + pageViewer + "/faves");
            ref.once("value", function(snapshot) {
                var favorite = snapshot.child(data).exists();
                //return favorite;
                if (favorite == true) {
                    $("#fave").hide();
                } else {
                    $("#unfave").hide();
                }
            });
        }
    </script>


    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>

</html>
