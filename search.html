<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="https://cdn.firebase.com/js/client/2.2.7/firebase.js"></script>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes.js"></script>

    <title>Brouze | Search Tutors</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/search-page.css" rel="stylesheet">
 

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body onload="parseQueryString()">

    <!-- Fixed navbar -->
    
     <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <p class="navbar-brand">Brouze</p>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <!--
                    <form class="navbar-form" role="search">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search Tutors" name="srch-term" id="srch-term">
                        </div>    
                        <div class="btn-group">
                            <button class="btn dropdown-toggle" data-toggle="dropdown">
                              Keyword
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                              <li><a href=""></a></li>
                              <li><a href="">Subject</a></li>
                              <li><a href="">Tutor Name</a></li>
                            </ul>
                        </div>
                      <div class="input-group-btn">
                            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                      </div>
                            
                    </form>-->
                    <form class="navbar-form" role="form">
                        <div class="input-group">
                          <div class="form-group">
                               <!--<input type="text" class="form-control" id="srch-term" placeholder="Search Brouze">-->
                              <select class="form-control" id="subject">
                              <option>Search Brouze</option>
                              <option>Search All Tutors</option>
                              <option>English</option>
                              <option>History</option>
                              <option>AP Spanish</option>
                              <option>French</option>
                              <option>AP French</option>
                              <option>AP Computer Science</option>
                              <option>Computer Science</option>
                              <option>Pre-Algebra</option>
                              <option>Algebra</option>
                              <option>Algebra 2</option>
                              <option>Geometry</option>
                              <option>Trigonometry</option>
                              <option>Precalculus</option>
                              <option>AP Calculus AB</option>
                              <option>AP Calculus BC</option>
                              <option>Statistics</option>
                              <option>Rhetoric</option>
                              <option>AP English Literature</option>
                              <option>AP English Language</option>
                              <option>AP European History</option>
                              <option>AP United States History</option>
                              <option>Biology</option>
                              <option>AP Biology</option>
                              <option>Chemistry</option>
                              <option>Chemistry Honors</option>
                              <option>AP Chemistry</option>
                              <option>AP Environmental Science</option>
                              <option>Physics</option>
                              <option>AP Physics</option>
                              <option>SAT</option>
                              <option>ACT</option>
                           </select>
                              
                          </div>
                          <div class="input-group-btn">
                            <ul class="dropdown-menu dropdown-menu-right">
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Subject</a>
                                        <ul class="dropdown-menu">
                                          <li><a href="">Subject</a></li>
                                          <li><a href="">Subject</a></li>
                                          <li><a href="">Subject</a></li>
                                          <li><a href="">Subject</a></li>
                                          <li><a href="">Subject</a></li>
                                          <li><a href="">Subject</a></li>
                                        </ul>
                               </li>
                               <li><a href="">Tutor Name</a></li>
                            </ul>
                            <button class="btn btn-default" type="button" onclick="getWord()"><i class="glyphicon glyphicon-search"></i></button>
                            <button class="btn btn-default" type="button" id="filCon" onclick="swap()"><i class="glyphicon glyphicon-apple"></i>Searching tutors</button>
                          </div><!-- /btn-group -->
                        </div><!-- /input-group -->
                        <!--<button class="btn btn-default" type="button" onclick="getWord()"><i class="glyphicon glyphicon-search"></i></button>-->
                    </form>
                </ul>
                <ul class="nav navbar-nav">
                    <li><a onclick="helpRedirect()">Help</a></li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="dropdown">
                        <a id="dropMenu" href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Menu  <span class="caret" aria-hidden="true"></span></a>
                        <ul class="dropdown-menu">
                            <li><a onclick="home()">Profile</a></li>
                            <li><a onclick="saveRedirect()">Saved Tutors</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a onclick="signOut()">Sign Out</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </nav>


    <!--Content-->
    <div id="title" class="container">
        <div class="row">
           
                <h1>Results</h1>
            
        </div>
    </div>
    
    <div id="results" class="container">
        <div class="row">
            <div class="col-lg-3">
                <h3></h3>
                <div class="well" id="two">
                    <h3>Search Specific User</h3>
                    <form>
                        <!--<div class="form-group">
                            <label>Search by Name:</label>
                            <input type="text" class="form-control" id="searchIDname">
                        </div>-->
                        <div class="form-group">
                            <label>Search Username:</label>
                            <input type="text" class="form-control" id="searchID">
                        </div>
                        <div class="form-group"> 
                          <button type="button" class="btn btn-primary" onclick="applyFilter()">Filter</button>
                          <button type="button" class="btn btn-warning" onclick="clearFilter()">Remove Filter</button>
                        </div>
                    </form>
                </div>
                <div class="well">
                    <h3>Refine Search</h3>
                    <form>
                        <!--<div class="form-group">
                            <label>Search by Name:</label>
                            <input type="text" class="form-control" id="searchIDname">
                        </div>-->
                        <!--<div class="form-group">
                            <label>Search Username:</label>
                            <input type="text" class="form-control" id="searchID">
                        </div>-->
                        <div class="form-group">
                            <label>Zipcode:</label>
                            <input type="text" class="form-control" id="zipcode">
                        </div>
                        <div class="form-group">
                            <label>School:</label>
                            <input type="text" class="form-control" id="school">
                        </div>
                        <!--<div class="form-group">
                            <label>Teacher:</label>
                            <input type="text" class="form-control" id="teacher">
                        </div>-->
                        <div class="form-group">
                           <label for="age">Minimum Age:</label>
                           <select class="form-control" id="minage">
                              <option></option>
                              <option>13</option>
                              <option>14</option>
                              <option>15</option>
                              <option>16</option>
                              <option>17</option>
                              <option>18</option>
                              <option>19</option>
                           </select>
                        </div>
                        <div class="form-group">
                           <label for="age">Maximum Age:</label>
                           <select class="form-control" id="maxage">
                              <option></option>
                              <option>13</option>
                              <option>14</option>
                              <option>15</option>
                              <option>16</option>
                              <option>17</option>
                              <option>18</option>
                              <option>19</option>
                           </select>
                        </div>
                        <div class="form-group"> 
                          <button type="button" class="btn btn-primary" onclick="applyFilter()">Filter</button>
                          <button type="button" class="btn btn-warning" onclick="clearFilter()">Remove Filter</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-lg-9" id="miniList">
               <!-- <div class="container mini-profile">
                    <div class="row">
                    <div class="col-md-4">
                       <img class="img-responsive" src="http://www.babylonpuzzles.com/6866-thickbox_default/500-pcs---curious-kitten---square-by-ravensburger.jpg" id="mini-pic">
                    </div>
                    <div class="col-md-8">
                        <h2>Buttface McGee</h2>
                        <h3>Junior at Piedmont High</h3>
                        <h4>Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa...</h4>
                    </div>
                    </div>
                
                
                
                </div>-->
            </div>
        </div>
    </div>
    
    <div class="foot">
        <h5>Copyright 2015 - YAAAS Labs</h5>
    </div>
    <script>
        
            console.log("hey ready");
            var Fzipcode = $("#zipcode").val();
            var Fminage = $("#minage").val();
            var Fmaxage = $("#maxage").val();
            var Fteacher = $("#teacher").val();
            var Fminprice = $("#minprice").val();
            var Fmaxprice = $("#maxprice").val();
            var Fschool = $("#school").val();
            var Fusername = $("#searchID").val();
            //var Fname = $("#searchIDname").val();
            //var Floc1 = $('#lib').prop('checked');
            //var Floc2 = $('#yourHome').prop('checked');
            //var Floc3 = $('#online').prop('checked');//reading check boxes
            var results = 0;
            var filter = true;
            var keyWord;
            var userData;
            var pageWord;
            var globalWord;
            var faveUser;
            var parseQueryString = function() {
                console.log("go 42");
                var queryString = window.location.search;
                console.log(queryString);
                console.log(queryString);
                //var decrypted = CryptoJS.AES.decrypt(queryString,"mingo").toString(CryptoJS.enc.Utf8);
                //console.log("decrypted: " + decrypted);
                //queryString = decrypted;
                console.log(queryString);
                //var res = queryString.replace("%20", " ");
                //decodeURI(queryString)
                //decodeURIComponent(queryString.replace(/\+/g, '%20') );
                queryString = queryString.substring(1);
                console.log(queryString)
                queryString = atob(queryString);
                var res = queryString.replace(/%20/g, " ");
                console.log(res);
                queryString = res;
                var params = {},
                    queries, temp, i, l;
                // Split into key/value pairs
                queries = queryString.split("&");
                console.log(queries);
                // Convert the array of strings into an object
                for (i = 0, l = queries.length; i < l; i++) {
                    temp = queries[i].split('=');
                    console.log(temp);
                    //temp.replace(/%20/g, " ");
                    params[temp[0]] = temp[1];

                }
                //console.log("dude");
                userData = params["username"];
                //console.log(params["username"]);
                //accessInfo(params["username"]);
                //console.log("page Owner"+params["pageOwner"]);
                //console.log("here is the search word");
                pageWord = params["word"];
                if(pageWord =='Search All Tutors'){
                    pageWord = '';
                }
                //console.log(pageWord);
                $("#subject").val(pageWord);
                search(pageWord);
        };
        function getWord(){
            keyWord = $("#subject").val();
            if(($("#searchID").val() != '') ){
                $("#searchID").val('');
                applyFilter();
            }
            else{
            //console.log(keyWord);
                if(keyWord == "Search All Tutors"){
                    keyWord = '';
                }
                search(keyWord);
            }
            
        }
       $('#srch-term').bind('keypress', function(e) {
            if(e.keyCode==13){
                getWord();
                // Enter pressed... do anything here...
            }
        });
       function search(searchVal){
           globalWord=searchVal;
           console.log("in search");
           var tempZip = $("#zipcode").val();
           console.log("tempZip: "+tempZip);
           if(tempZip != ''){
               console.log("zip has value");
           }
           var tempAge = $("#minage").val();
           console.log("tempAge: "+tempAge);
           for(var i = 0;i < results;i++){
               //$("#miniList").remove();
               //$("#miniList:last-child").remove();
               $("#miniList").children().last().remove();
           }
           //i($("#searchID").val() !=''){
               //$("#searchID").val('');
               //applyFilter();
           //}
           
           console.log("xox 1");
           results = 0;
            var nameRef = new Firebase("https://brouze.firebaseio.com/users");
            nameRef.once("value", function(snapshot) {
                snapshot.forEach(function(childSnapshot) {
                    var key = childSnapshot.key();
                    if(key != "keys"){
                        var childData = childSnapshot.val();
                        var username = childData.basicInfo.username;
                        var name = childData.basicInfo.name;
                        //var childRef = new Firebase("https://brouze.firebaseio.com/users/" + key);
                        var zipcode =childData.basicInfo.zipcode;
                        var age = childData.basicInfo.age;
                        if(filter == true){
                            var skills = snapshot.child(key+"/skills/"+searchVal).exists();
                        }
                        else{
                            var skills = snapshot.child(key+"/weaknesses/"+searchVal).exists();
                        }
                        var school = childData.basicInfo.school;
                        //var loc1 = childData.basicInfo.loc1;
                        //var loc2 = childData.basicInfo.loc2;
                        //var loc3 = childData.basicInfo.loc3;
                        //var username = childRef.username
                        //console.log(name);
                        //console.log(username);
                        //console.log(key);
                        //console.log(skills);
                        console.log(searchVal);
                        console.log("Fusername: "+ Fusername);
                        if((Fusername == '')/*&&(Fname == '')*/){
                            if(skills==true){
                                //console.log("hey look at me  "+ Floc1+" and "+loc1);
                                if((Fzipcode == '') || (zipcode == Fzipcode)){
                                    if(((Fminage == '')||(age >= Fminage))&&((Fmaxage == '')||(age <= Fmaxage))){
                                        if((Fschool=='')||(school==Fschool)){
                                            console.log(name);
                                            addMini(key);
                                        }
                                    }
                                }
                            }
                        }
                        else{
                            if(username == Fusername){
                                addMini(key);
                                console.log("xox2");
                            }
                        }
                        //console.log("xox1");
                    }
              });
            });
       }
        function addMini(miniKey){
            console.log("xox 4");
            //var profilepic;
            //var name;
            //var grade;
            //var school;
            //var comment;
            //console.log("hey you");
            //console.log(miniKey);
            var ref = new Firebase("https://brouze.firebaseio.com/users/" + miniKey + "/basicInfo");
            ref.on("value", function(snapshot) {
                var currentUser = snapshot.val();
                //console.log("just so you know, we are in the thing");
                //console.log(currentUser);
                //console.log(currentUser.username);
                //console.log(currentUser.name);
                //console.log("lol");
                var name = currentUser.name;
                var username = currentUser.username;
                console.log(username);
                console.log("xox 3");
                var grade = currentUser.grade;
                var school = currentUser.school;
                var profilepic = currentUser.profilepic;
                var comment = currentUser.blurb;
                checkIfFave(miniKey,username);
                $("#miniList").append('<div class="container mini-profile"  id='+username+'><div class="row"><div class="col-md-4"><img class="img-responsive" src="'+profilepic+'"id="mini-pic"></div><div class="col-md-8"><h2>'+name+'</h2><h3>'+grade+' at '+ school+'</h3><h4>'+comment+'</h4></div></div></div>');
                //apply_click(miniKey,results);
                
                $("#miniList").on('click', '#'+username, function(){
                //$(document.getElementById(results)).onclick = function(){
    // this is your click-handler
                   
                    var status = $(this).attr('id');
                    console.log(status);
                    console.log(miniKey);
                    //console.log(miniKey.ID);
                    var secret = "username=" + miniKey + "&pageOwner="+userData;
                    secret = btoa(secret);
                     window.location.href="profile.html?" + secret;
                });
                
                

                /*$( "#profile" ).wrap(function() {
                  console.log("ummmm");
                  window.location.replace("profile.html?" + "username=" + miniKey + "&pageOwner="+miniKey);
                });*/
                //console.log("after all that nonsense");
                //console.log("go 36");
            }, function(errorObject) {
                console.log("The read failed: " + errorObject.code);
            });
            //$("#miniList").remove();
            //console.log("xox 2");
            results++;
            //console.log(results);
            //console.log("xox 3");
            //console.log(name);
            //console.log(school);
            //console.log(grade);
            //console.log("xox 3");
            //console.log(miniRef.username);
            //image url
            //name
            //grade
            //personal comment
            //console.log("xox 4");
        }
        function profileRedirect(ownerKey){
            console.log("hey we are redirecting");
             window.location.href="profile.html?" + "username=" + ownerKey + "&pageOwner="+ownerKey;
        }  
        function apply_click(ownerKey,resultNum) {
            $('#profile').click( function() {
                alert('clicked'+ownerKey); 
                window.location.href="profile.html?" + "username=" + ownerKey + "&pageOwner="+ownerKey;
            });    
        }
        function home(){
            var secret  = "username=" + userData + "&pageOwner="+userData;
            secret = btoa(secret);
            window.location.href="profile.html?" + secret;
        }
        /*$("#miniList").click(function(event){
            alert(event.target.id);
        });*/
        function applyFilter(){
            
            Fzipcode = $("#zipcode").val();
            if(Fzipcode != ''){
                console.log("zipcode: "+Fzipcode);
            }
            Fminage = $("#minage").val();
            if(Fminage != ''){
                console.log("minage: "+Fminage);
            }
            Fmaxage = $("#maxage").val();
            if(Fmaxage != ''){
                console.log("maxage: "+Fmaxage);
            }
            Fteacher = $("#teacher").val();
            if(Fteacher != ''){
                console.log("teacher: "+Fteacher);
            }
            Fminprice = $("#minprice").val();
            if(Fminprice != ''){
                console.log("minprice: "+Fminprice);
            }
            Fmaxprice = $("#maxprice").val();
            if(Fmaxage != ''){
                console.log("maxprice: "+Fmaxprice);
            }
            Floc1 = $('#lib').prop('checked');//reading check boxes
            if(Floc1 != ''){
                console.log("lib: "+Floc1);
            }
            Floc2 = $('#yourHome').prop('checked');//reading check boxes
            if(Floc2 != ''){
                console.log("yourHome: "+Floc2);
            }
            Floc3 = $('#online').prop('checked');//reading check boxes
            if(Floc3 != ''){
                console.log("online: "+Floc3);
            }
            Fschool = $('#school').val();//reading check boxes
            if(Fschool != ''){
                console.log("school: "+Fschool);
            }
            Fusername = $('#searchID').val();//reading check boxes
            if(Fschool != ''){
                console.log("username: "+Fusername);
            }
            clear();
            search(globalWord);

        }
        function clearFilter(){
            $("#zipcode").val('')             
            Fzipcode = $("#zipcode").val();
            $("#minage").val('');
            Fminage = $("#minage").val();
            $("#maxage").val('');
            Fmaxage = $("#maxage").val();
            $("#teacher").val('');
            Fteacher = $("#teacher").val();
            $("#minprice").val('');
            Fminprice = $("#minprice").val();
            $("#maxprice").val('');
            Fmaxprice = $("#maxprice").val();
            $('#school').val();
            Fschool = $('#school').val();//reading check boxes
            $('#searchID').val('');
            Fusername = $('#searchID').val();//reading check boxes
            clear();
            search(globalWord);
        }
        function clear(){
            for(var i = 0;i < results;i++){
               //$("#miniList").remove();
               //$("#miniList:last-child").remove();
               $("#miniList").children().last().remove();
           }
            //console.log(results);
        }
        function signOut() {
            var outRef = new Firebase("https://brouze.firebaseio.com");
            outRef.unauth();
            window.location.href="index.html";

        }
        function saveRedirect(){
            var secret = "username=" + userData + "&pageOwner=" + userData;
            secret = btoa(secret);
            window.location.href="savedtutors.html?" + secret;
        }
        function helpRedirect(){
            var secret = "username=" + userData + "&pageOwner=" + userData;
            secret= btoa(secret);
            window.location.href="help.html?" + secret
        }

        function userExistsCallback(userId, exists) {
          if (exists) {
            faveUser = true;
            //alert('user ' + userId + ' exists!');
          } else {
            //alert('user ' + userId + ' does not exist!');
              faveUser = false;
              //console.log("newUser is" + newUser);//here it is true
          }
        }
        // Tests to see if /users/<userId> has any data.
        function checkIfFave(tempKey,tempUser){
          var usersRef = new Firebase("https://brouze.firebaseio.com/users/"+userData+"/faves");
          usersRef.child(tempKey).once('value', function(snapshot) {
            var exists = (snapshot.val() !== null);
            userExistsCallback(tempKey, exists);
              console.log("right before " + faveUser);//here it is false
              if(faveUser == true){//this is a favorite
                 $("#"+tempUser).append('<span class="glyphicon glyphicon-star" aria-hidden="true"></span>');
              }
          });
        }
        function swap(){
            filter = !filter;
            if(filter == false){
                //console.log("this is already a saved tutor");
                    //$("#fave").hide();
                    $("#filCon").text("");
                    $("#filCon").append('<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>  Searching students');
                    console.log("you are searching students");
                    //false means searching students
                    //$("#filCon").attr("id", "fave");
                   
            }
            else{
                console.log("this is already a saved tutor");
                    //$("#fave").hide();
                    $("#filCon").text("");
                    $("#filCon").append('<span class="glyphicon glyphicon-apple" aria-hidden="true"></span>  Searching tutors');
                    console.log("you are searching tutors");
                    //$("#filCon").attr("id", "fave");
                   
            }
            applyFilter();
        }
    </script>
    
    
    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>

</html>


